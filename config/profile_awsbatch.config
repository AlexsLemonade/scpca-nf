// profile for wave and fusion filesystem enabled batch pipeline

workDir = 's3://ccdl-scpca-workdir-997241705947-us-east-1/work'
docker.enabled = true
wave.enabled = true
fusion.enabled = true

aws {
  batch {
    maxTransferAttempts = 3
    maxSpotAttempts = 2
  }
  region = 'us-east-1'
}

process {
  executor = 'awsbatch'
  resourceLimits = [cpus: 24, memory: 512.GB]
  queue = { task.attempt < 3 ? 'scpca-nf-batch-default-queue' : 'scpca-nf-batch-priority-queue' }
  withLabel: long_running {
    queue = { task.attempt < 2 ? 'scpca-nf-batch-default-queue' : 'scpca-nf-batch-priority-queue' }
  }
}
