app_content:
  entrypoint: main.nf
  executor_version: 24.10.6
class: nextflow
cwlVersion: None
doc: "# scpca-nf v0.9.1a


  The `scpca-nf` workflow is used to process 10x single-cell data as part of the
  [Single-cell Pediatric Cancer Atlas (ScPCA) project](https://scpca.alexslemonade.org/).


  The workflow processes fastq files from single-cell and single-nuclei RNA-seq
  samples using [alevin-fry](https://alevin-fry.readthedocs.io/en/latest/) to create
  gene by cell matrices.

  The workflow outputs gene expression data in two formats: as [`SingleCellExperiment`
  objects](https://www.bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html)
  and as [`AnnData` objects](https://anndata.readthedocs.io/en/latest/).

  Reads from samples are aligned using selective alignment, to an index with transcripts
  corresponding to spliced cDNA and to intronic regions, denoted by alevin-fry as
  `splici`.

  These matrices are filtered and additional processing is performed to calculate
  quality control statistics, create reduced-dimension transformations, assign cell
  types using both [`SingleR`](https://bioconductor.org/packages/release/bioc/html/SingleR.html)
  and [`CellAssign`](https://docs.scvi-tools.org/en/stable/user_guide/models/cellassign.html),
  and create output reports.

  `scpca-nf` can also process libraries with ADT tags (e.g., CITE-seq), multiplexed
  libraries (e.g., cell hashing), bulk RNA-seq, and spatial transcriptomics samples.


  Full documentation for the workflow is available in the [`scpca-nf` GitHub repository](https://github.com/AlexsLemonade/scpca-nf).
  Please also refer to the additional [instructions for use on Cavatica](https://github.com/AlexsLemonade/scpca-nf/blob/main/cavatica-instructions.md).


  ## Steps to run the workflow on Cavatica


  To run the `scpca-nf` workflow on Cavatica, you will need to follow the following
  steps:


  1. Upload all required input files to your Cavatica project

  2. Prepare a metadata files for runs and samples, as well as any additional files
  that may be required for your samples. See [Required input files](https://github.com/AlexsLemonade/scpca-nf/blob/main/cavatica-instructions.md#required-input-files)
  for more details.

  3. Transform the paths in the run metadata file to Cavatica `vs://` paths using
  the `sbmanifest` tool. See [Adding Cavatica paths to metadata files](https://github.com/AlexsLemonade/scpca-nf/blob/main/cavatica-instructions.md#adding-cavatica-paths-to-metadata-files)
  for more details.

  4. Set options and run the `scpca-nf` workflow on Cavatica using the web interface.

  "
hints:
  - class: sbg:NextflowExecutionMode
    value: multi-instance
inputs:
  - doc: Name of the directory to use for workflow outputs
    id: outdir
    label: Output directory
    inputBinding:
      prefix: --outdir
    sbg:category: Input/output options
    sbg:toolDefaultValue: scpca_out
    default: scpca_out
    type:
      - "null"
      - string
  - doc: Select which profile(s) you want to use for task execution.
    id: profile
    inputBinding:
      itemSeparator: ","
      prefix: -profile
    default:
      - cavatica
    label: Profiles
    type:
      - "null"
      - items:
          name: profile
          symbols:
            - cavatica
            - stub
          type: enum
        type: array
  - doc:
      The input file with information for each run to be processed. See <https://github.com/AlexsLemonade/scpca-nf/blob/main/external-instructions.md#prepare-the-run-metadata-file>
      for format information.
    format: text/tab-separated-values
    id: run_metafile
    inputBinding:
      prefix: --run_metafile
    label: Run metadata file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    type: File
  - doc:
      A sample information file. See <https://github.com/AlexsLemonade/scpca-nf/blob/main/external-instructions.md#prepare-the-sample-metadata-file>
      for more information.
    format: text/tab-separated-values
    id: sample_metafile
    inputBinding:
      prefix: --sample_metafile
    label: Sample metadata file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    type: File
  - doc:
      The project cell type metadata file. Only used if perform cell typing is
      on.
    format: text/tab-separated-values
    id: project_celltype_metafile
    inputBinding:
      prefix: --project_celltype_metafile
    label: Project cell type metadata file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ""
    type:
      - "null"
      - File
  - doc:
      A file containing information to map cellhash barcodes to samples. See <https://github.com/AlexsLemonade/scpca-nf/blob/main/external-instructions.md#multiplexed-cellhash-libraries>
      for more information.
    format: text/tab-separated-values
    id: cellhash_pool_file
    inputBinding:
      prefix: --cellhash_pool_file
    label: Cellhash pool file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ""
    type:
      - "null"
      - File
  - doc:
      A comma-separated list of run IDs to run. Use "All" to run all samples in
      the run_metafile.
    id: run_ids
    inputBinding:
      prefix: --run_ids
    label: Run IDs
    sbg:category: Processing options
    sbg:toolDefaultValue: All
    type:
      - "null"
      - string
  - doc:
      A comma-separated list of project IDs. All samples with the provided project
      IDs will be run.
    id: project
    inputBinding:
      prefix: --project
    label: Project ID(s)
    sbg:category: Processing options
    type:
      - "null"
      - string
  - doc: Skip genetic demultiplexing steps, even if bulk data is present.
    id: skip_genetic_demux
    inputBinding:
      prefix: --skip_genetic_demux
    label: Skip genetic demultiplexing
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      Cell typing is skipped by default; use this option to incorporate cell type
      annotations. Requires that `project_celltype_metafile` is set.
    id: perform_celltyping
    inputBinding:
      prefix: --perform_celltyping
    label: Perform cell typing
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      CNV inference is skipped by default; use this option to incorporate CNV annotation.
      Requires cell typing.
    id: perform_cnv_inference
    inputBinding:
      prefix: --perform_cnv_inference
    label: Perform CNV inference
    sbf:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      alevin-fry outputs are not published by default. Use this option to publish
      them to the `checkpoints` folder.
    id: publish_fry_outs
    inputBinding:
      prefix: --publish_fry_outs
    label: Publish alevin-fry outputs
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc: Root location containing reference files.
    id: ref_rootdir
    inputBinding:
      prefix: --ref_rootdir
    label: References root directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references
    type:
      - "null"
      - Directory
  - doc: JSON file describing the locations of reference files within the root directory.
    format: application/json
    id: ref_json
    inputBinding:
      prefix: --ref_json
    label: Reference JSON file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/scpca-refs.json
    type:
      - "null"
      - File
  - doc: Directory containing 10x barcode files.
    id: barcode_dir
    inputBinding:
      prefix: --barcode_dir
    label: Barcode file directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/barcodes/10X
    type:
      - "null"
      - Directory
  - doc: Directory containing 10x Flex probe references
    id: probes_dir
    inputBinding:
      prefix: --probes_dir
    label: Probe files directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/flex-probe-refs
    type:
      - "null"
      - Directory
  - doc: 10x Flex probeset reference file
    id: flex_probeset_file
    inputBinding:
      prefix: --flex_probeset_file
    label: Probe files directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/flex-probe-refs/Chromium_Human_Transcriptome_Probe_Set_v1.1.0_GRCh38-2024-A.csv
    type:
      - "null"
      - File
  - doc: Directory containing cell type reference files.
    id: celltype_ref_dir
    inputBinding:
      prefix: --celltype_ref_dir
    label: Cell type reference directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype
    type:
      - "null"
      - Directory
  - doc: Directory containing `SingleR` model files.
    id: singler_models_dir
    inputBinding:
      prefix: --singler_models_dir
    label: SingleR models directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype/singler_models
    type:
      - "null"
      - Directory
  - doc: Directory containing `CellAssign` reference files.
    id: cellassign_ref_dir
    inputBinding:
      prefix: --cellassign_ref_dir
    label: CellAssign reference directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype/cellassign_references
    type:
      - "null"
      - Directory
  - doc: Directory containing SCimilarity foundational model
    id: scimilarity_model_dir
    inputBinding:
      prefix: --scimilarity_model_dir
    label: SCimilarity reference model directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype/scimilarity_references/model_v1.1
    type:
      - "null"
      - Directory
  - doc: Map of SCimilarity annotations to Cell Ontology terms
    id: scimilarity_ontology_map_file
    inputBinding:
      prefix: --scimilarity_ontology_map_file
    label: SCimilarity ontology mapping file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/scimilarity-mapped-ontologies.tsv
    type:
      - "null"
      - File
  - doc: Reference file for consensus cell type calling
    id: consensus_ref_file
    inputBinding:
      prefix: --consensus_ref_file
    label: Consensus cell type reference file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/consensus-cell-type-reference.tsv
    type:
      - "null"
      - File
  - doc: Reference file assigning consensus cell types to a validation group.
    id: validation_groups_file
    inputBinding:
      prefix: --validation_groups_file
    label: Validation cell type group reference file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/consensus-validation-groups.tsv
    type:
      - "null"
      - File
  - doc: Reference file containing marker genes associated with each validation group.
    id: validation_markers_file
    inputBinding:
      prefix: --validation_markers_file
    label: Validation cell type marker gene reference file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/validation-markers.tsv
    type:
      - "null"
      - File
  - doc: Reference file mapping broad diagnoses to individual sample diagnoses for counting inferCNV normal reference cells.
    id: diagnosis_groups_file
    inputBinding:
      prefix: --diagnosis_groups_file
    label: Diagnosis groups file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/diagnosis-groups.tsv
    type:
      - "null"
      - File
  - doc: Reference file mapping broad diagnoses to validation cell type groups for counting inferCNV normal reference cells.
    id: diagnosis_celltypes_file
    inputBinding:
      prefix: --diagnosis_celltypes_file
    label: Diagnosis cell types file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/diagnosis-celltype-groups.tsv
    type:
      - "null"
      - File
  - id: seed
    inputBinding:
      prefix: --seed
    label: Random number seed
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 2021
    type:
      - "null"
      - int
  - doc:
      Use to set a limit for the highest memory jobs. Should be a string in the
      format integer-unit e.g. `512.GB`
    id: max_memory
    inputBinding:
      prefix: --max_memory
    label: Maximum memory used for high memory jobs.
    sbg:category: Resource maximums
    sbg:icon: fas fa-memory
    sbg:pattern: ^\d+(\.\d+)?\.?\s*(K|M|G|T)?B$
    sbg:toolDefaultValue: 512 GB
    type:
      - "null"
      - string
  - doc:
      List of files not added as explicit workflow inputs but required for workflow
      execution.
    id: auxiliary_files
    label: Auxiliary files
    type:
      - "null"
      - items: File
        type: array
  - doc: Provide parameters through a JSON format input file.
    id: params_file
    inputBinding:
      prefix: -params-file
    label: Params files
    sbg:fileTypes: JSON
    type:
      - "null"
      - File
outputs:
  # currently this requires the outdir to be a String
  # I might want to test if setting it as a Directory and using inputs.outdir.path can work
  - id: output_dir
    label: Workflow output directory
    outputBinding:
      glob: $(inputs.outdir)
    type: Directory
requirements:
  - class: InlineJavascriptRequirement
sbg:links:
  - id: https://github.com/AlexsLemonade/scpca-nf
    label: Home Page
