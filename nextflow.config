// global parameters for workflows
params{
  // Workflow metadata
  workflow_url = 'https://github.com/AlexsLemonade/scpca-nf'

  // Docker container images
  SALMON_CONTAINER = 'quay.io/biocontainers/salmon:1.5.2--h84f40af_0'
  ALEVINFRY_CONTAINER = 'quay.io/biocontainers/alevin-fry:0.4.1--h7d875b9_0'
  SCPCATOOLS_CONTAINER = 'ghcr.io/alexslemonade/scpca-tools:v0.1.1'


  // Input data table
  run_metafile = 's3://ccdl-scpca-data/sample_info/scpca-library-metadata.tsv'

  // Output base directory
  outdir = "s3://nextflow-ccdl-results/scpca/processed"

  
  // Assembly, annotation, and index locations
  assembly = 'Homo_sapiens.GRCh38.104'
  ref_dir       = 's3://nextflow-ccdl-data/reference/homo_sapiens/ensembl-104'
  fasta         = 's3://nextflow-ccdl-data/reference/homo_sapiens/ensembl-104/fasta/Homo_sapiens.GRCh38.dna.primary_assembly.fa.gz'
  gtf           = 's3://nextflow-ccdl-data/reference/homo_sapiens/ensembl-104/annotation/Homo_sapiens.GRCh38.104.gtf.gz'
  index_path    = 's3://nextflow-ccdl-data/reference/homo_sapiens/ensembl-104/salmon_index/Homo_sapiens.GRCh38.104.spliced_intron.txome'
  mito_file     = 's3://nextflow-ccdl-data/reference/homo_sapiens/ensembl-104/annotation/Homo_sapiens.GRCh38.104.mitogenes.txt'
  t2g_3col_path = 's3://nextflow-ccdl-data/reference/homo_sapiens/ensembl-104/annotation/Homo_sapiens.GRCh38.104.spliced_intron.tx2gene_3col.tsv'
  barcode_dir   = 's3://nextflow-ccdl-data/reference/10X/barcodes' 
 
  // Processing options
  af_resolution = 'cr-like' // alevin-fry quant resolution method: default is cr-like, can also use full, cr-like-em, parsimony, and trivial
  emptydrops_lower = 200 // emptydrops lower bound for cell UMI count
  seed = 2021   // random number seed for filtering (0 means use system seed)
}



profiles{
  standard {
    process.executor = 'local'
    docker.enabled = true
  }
  // AWS batch profile
  batch {
    bucketDir = 's3://nextflow-ccdl-data/work'
    aws{
      region = 'us-east-1'
      batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
    }
    process{
      executor = 'awsbatch'
      queue = 'nextflow-batch-default-queue'
      // following options from nf-core
      errorStrategy = { task.attempt < 2 ? 'retry' : 'finish' }
      maxRetries = 1
      maxErrors = '-1'
      memory = { 4.GB * task.attempt}

      withLabel: mem_8 {
        memory = { 8.GB * task.attempt}
      }
      withLabel: cpus_12 {
        cpus = 12
        memory = { 24.GB * task.attempt}
      }
      withLabel: cpus_8 {
        cpus = 8
        memory = { 16.GB * task.attempt}
      }
    }
  }
}
