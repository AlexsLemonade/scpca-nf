// profile for wave and fusion filesystem enabled batch pipeline

workDir = 's3://ccdl-scpca-workdir-997241705947-us-east-1/work'
wave.enabled = true
fusion.enabled = true

env {
  AWS_DEFAULT_REGION = 'us-east-1'
  AWS_REGION = 'us-east-1'
}

docker {
  enabled = true
  envWhitelist = ['AWS_DEFAULT_REGION', 'AWS_REGION']
}

aws {
  batch {
    maxTransferAttempts = 3
    maxSpotAttempts = 2
  }
  region = 'us-east-1'
}

params.pullthrough_registry = '997241705947.dkr.ecr.us-east-1.amazonaws.com'

process {
  executor = 'awsbatch'
  resourceLimits = [cpus: 24, memory: 512.GB]
  queue = { task.attempt < 3 ? 'scpca-nf-batch-default-queue' : 'scpca-nf-batch-priority-queue' }
  withLabel: long_running {
    queue = { task.attempt < 2 ? 'scpca-nf-batch-default-queue' : 'scpca-nf-batch-priority-queue' }
  }
}
