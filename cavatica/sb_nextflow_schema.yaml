app_content:
  entrypoint: main.nf
class: nextflow
cwlVersion: None
doc: "# `scpca-nf`


  The  `scpca-nf` workflow is used to process 10x single-cell data as part of the
  [Single-cell Pediatric Cancer Atlas (ScPCA) project](https://scpca.alexslemonade.org/).


  The workflow processes fastq files from single-cell and single-nuclei RNA-seq
  samples using [alevin-fry](https://alevin-fry.readthedocs.io/en/latest/) to create
  gene by cell matrices.

  The workflow outputs gene expression data in two formats: as [`SingleCellExperiment`
  objects](https://www.bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html)
  and as [`AnnData` objects](https://anndata.readthedocs.io/en/latest/).

  Reads from samples are aligned using selective alignment, to an index with transcripts
  corresponding to spliced cDNA and to intronic regions, denoted by alevin-fry as
  `splici`.

  These matrices are filtered and additional processing is performed to calculate
  quality control statistics, create reduced-dimension transformations, assign cell
  types using both [`SingleR`](https://bioconductor.org/packages/release/bioc/html/SingleR.html)
  and [`CellAssign`](https://docs.scvi-tools.org/en/stable/user_guide/models/cellassign.html),
  and create output reports.

  `scpca-nf` can also process libraries with ADT tags (e.g., CITE-seq), multiplexed
  libraries (e.g., cell hashing), bulk RNA-seq, and spatial transcriptomics samples.


  For more information on the contents of the output files and the processing of
  all modalities, please see the [ScPCA Portal docs](https://scpca.readthedocs.io/en/latest/).

  "
hints:
  - class: sbg:NextflowExecutionMode
    value: multi-instance
inputs:
  - doc: Select which profile(s) you want to use for task execution.
    id: profile
    inputBinding:
      itemSeparator: ","
      prefix: -profile
    label: Profiles
    type:
      - "null"
      - items:
          name: profile
          symbols:
            - example
            - standard
            - stub
          type: enum
        type: array
  - doc:
      The input file with information for each run to be processed. See <https://github.com/AlexsLemonade/scpca-nf/blob/main/external-instructions.md#prepare-the-run-metadata-file>
      for format information.
    format: text/tab-separated-values
    id: run_metafile
    inputBinding:
      prefix: --run_metafile
    label: Run metadata file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: run_metadata.tsv
    type:
      - "null"
      - File
  - doc:
      A sample information file. See <https://github.com/AlexsLemonade/scpca-nf/blob/main/external-instructions.md#prepare-the-sample-metadata-file>
      for more information.
    format: text/tab-separated-values
    id: sample_metafile
    inputBinding:
      prefix: --sample_metafile
    label: Sample metadata file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: sample_metadata.tsv
    type:
      - "null"
      - File
  - doc:
      A file containing information to map cellhash barcodes to samples. See <https://github.com/AlexsLemonade/scpca-nf/blob/main/external-instructions.md#multiplexed-cellhash-libraries>
      for more information.
    format: text/tab-separated-values
    id: cellhash_pool_file
    inputBinding:
      prefix: --cellhash_pool_file
    label: Cellhash pool file
    sbg:category: Input/output options
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: multiplex_pools.tsv
    type:
      - "null"
      - File
  - doc: Directory for final output files.
    id: results_dir
    inputBinding:
      prefix: --results_dir
    label: Results directory
    sbg:category: Input/output options
    sbg:hidden: true
    sbg:icon: fas fa-folder-minus
    sbg:toolDefaultValue: scpca_out/results
    type:
      - "null"
      - Directory
  - doc: Directory to store checkpoint files, used when optionally skipping steps.
    id: checkpoints_dir
    inputBinding:
      prefix: --checkpoints_dir
    label: Checkpoints directory
    sbg:category: Input/output options
    sbg:hidden: true
    sbg:icon: fas fa-folder-minus
    sbg:toolDefaultValue: scpca_out/checkpoints
    type:
      - "null"
      - Directory
  - doc:
      A comma-separated list of run IDs to run. Use "All" to run all samples in
      the run_metafile.
    id: run_ids
    inputBinding:
      prefix: --run_ids
    label: Run IDs
    sbg:category: Processing options
    sbg:toolDefaultValue: All
    type:
      - "null"
      - string
  - doc:
      A comma-separated list of project IDs. All samples with the provided project
      IDs will be run.
    id: project
    inputBinding:
      prefix: --project
    label: Project ID(s)
    sbg:category: Processing options
    type:
      - "null"
      - string
  - doc:
      If alevin or salmon mapping has already been performed and output files exist,
      mapping is skipped by default.
    id: repeat_mapping
    inputBinding:
      prefix: --repeat_mapping
    label: Repeat mapping
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      If genetic demultiplexing has already been performed and output files exist,
      genetic demux is skipped by default.
    id: repeat_genetic_demux
    inputBinding:
      prefix: --repeat_genetic_demux
    label: Repeat genetic demultiplexing
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc: Skip genetic demultiplexing steps, even if bulk data is present.
    id: skip_genetic_demux
    inputBinding:
      prefix: --skip_genetic_demux
    label: Skip genetic demultiplexing
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      Cell typing is skipped by default; use this option to incorporate cell type
      annotations.
    id: perform_celltyping
    inputBinding:
      prefix: --perform_celltyping
    label: Perform cell typing
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      If cell type annotations have already been performed and output files exist,
      cell typing is skipped by default.
    id: repeat_celltyping
    inputBinding:
      prefix: --repeat_celltyping
    label: Repeat cell typing
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc:
      alevin-fry outputs are not published by default. Use this option to publish
      them to the `checkpoints` folder.
    id: publish_fry_outs
    inputBinding:
      prefix: --publish_fry_outs
    label: Publish alevin-fry outputs
    sbg:category: Processing options
    type:
      - "null"
      - boolean
  - doc: Root location containing reference files.
    id: ref_rootdir
    inputBinding:
      prefix: --ref_rootdir
    label: References root directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references
    type:
      - "null"
      - Directory
  - doc: Directory containing 10x barcode files.
    id: barcode_dir
    inputBinding:
      prefix: --barcode_dir
    label: Barcode file directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/barcodes/10X
    type:
      - "null"
      - Directory
  - doc: JSON file describing the locations of reference files within the root directory.
    format: application/json
    id: ref_json
    inputBinding:
      prefix: --ref_json
    label: Reference JSON file
    sbg:category: Reference files
    sbg:icon: fas fa-file-alt
    sbg:toolDefaultValue: ${projectDir}/references/scpca-refs.json
    type:
      - "null"
      - File
  - doc: Directory containing cell type reference files.
    id: celltype_ref_dir
    inputBinding:
      prefix: --celltype_ref_dir
    label: Cell type reference directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype
    type:
      - "null"
      - Directory
  - doc: Directory containing `SingleR` model files.
    id: singler_models_dir
    inputBinding:
      prefix: --singler_models_dir
    label: SingleR models directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype/singler_models
    type:
      - "null"
      - Directory
  - doc: Directory containing `CellAssign` reference files.
    id: cellassign_ref_dir
    inputBinding:
      prefix: --cellassign_ref_dir
    label: CellAssign reference directory
    sbg:category: Reference files
    sbg:icon: fas fa-folder-open
    sbg:toolDefaultValue: s3://scpca-references/celltype/cellassign_references
    type:
      - "null"
      - Directory
  - id: seed
    inputBinding:
      prefix: --seed
    label: Random number seed
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 2021
    type:
      - "null"
      - int
  - id: af_resolution
    inputBinding:
      prefix: --af_resolution
    label: alevin-fry quant resolution method.
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: cr-like-em
    type:
      - "null"
      - name: af_resolution
        symbols:
          - cr-like-em
          - cr-like
          - full
          - parsimony
          - trivial
        type: enum
  - id: spliced_only
    inputBinding:
      prefix: --spliced_only
    label: Only count spliced RNA reads.
    sbg:category: Algorithm parameters
    type:
      - "null"
      - boolean
  - doc: Cutoff for `miQC` to keep a cell.
    id: prob_compromised_cutoff
    inputBinding:
      prefix: --prob_compromised_cutoff
    label: miQC cutoff value
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 0.75
    type:
      - "null"
      - float
  - doc: Minimum number of genes detected required to keep a cell.
    id: gene_cutoff
    inputBinding:
      prefix: --gene_cutoff
    label: Minimum gene cutoff
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 200
    type:
      - "null"
      - int
  - doc: Number of highly variable genes to use for dimension reduction.
    id: num_hvg
    inputBinding:
      prefix: --num_hvg
    label: Number of highly variable genes
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 2000
    type:
      - "null"
      - int
  - doc: Number of principal components to keep from PCA.
    id: num_pcs
    inputBinding:
      prefix: --num_pcs
    label: Number of principal components
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 50
    type:
      - "null"
      - int
  - doc: Cluster algorithm to apply.
    id: cluster_algorithm
    inputBinding:
      prefix: --cluster_algorithm
    label: Clustering algorithm
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: louvain
    type:
      - "null"
      - name: cluster_algorithm
        symbols:
          - louvain
          - leiden
          - walktrap
        type: enum
  - id: cluster_weighting
    inputBinding:
      prefix: --cluster_weighting
    label: Edge weighting function to use with clustering algorithm.
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: jaccard
    type:
      - "null"
      - name: cluster_weighting
        symbols:
          - rank
          - number
          - jaccard
        type: enum
  - id: nearest_neighbors
    inputBinding:
      prefix: --nearest_neighbors
    label: Number of neighbors to use with clustering algorithm.
    sbg:category: Algorithm parameters
    sbg:toolDefaultValue: 20
    type:
      - "null"
      - int
  - doc:
      Use to set a limit for the highest memory jobs. Should be a string in the
      format integer-unit e.g. `512.GB`
    id: max_memory
    inputBinding:
      prefix: --max_memory
    label: Maximum memory used for high memory jobs.
    sbg:category: Resource maximums
    sbg:icon: fas fa-memory
    sbg:pattern: ^\d+(\.\d+)?\.?\s*(K|M|G|T)?B$
    sbg:toolDefaultValue: 512 GB
    type:
      - "null"
      - string
  - doc:
      List of files not added as explicit workflow inputs but required for workflow
      execution.
    id: auxiliary_files
    label: Auxiliary files
    type:
      - "null"
      - items: File
        type: array
  - doc: Provide parameters through a JSON format input file.
    id: params_file
    inputBinding:
      prefix: -params-file
    label: Params files
    sbg:fileTypes: JSON
    type:
      - "null"
      - File
outputs:
  - doc: Results directory (set dynamically from the --results_dir option)
    id: output_directory
    label: Output directory
    outputBinding:
      glob: $(inputs.results_dir)
    type: Directory
requirements:
  - class: InlineJavascriptRequirement
sbg:links:
  - id: https://github.com/AlexsLemonade/scpca-nf
    label: Home Page
